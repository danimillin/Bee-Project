{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Beereport\"\noutput:\n  html_document: default\n  html_notebook: default\n---\n\n```{r}\nlibrary (dismo); library(raster);library(rgdal);library (sp);\nlibrary (maptools); library (mgcv); library (gbm)\n```\n\n```{r}\n#cleaning bee data\nlibrary(tidyverse)\nlibrary(raster)\nbees<- read.csv(\"bombus_bor.csv\", header = FALSE)\nhead(bees)\nglimpse(bees)\nbees[2:nrow(bees), ]\nbeeloc<-bees[, 5:6]\ncollabs<-c(\"decimallat\", \"decimallong\", \"year\")\n#getting rid of gross columns\nbeesclean<-filter(bees, V11 == \"1340373\")\nbeedata<-beesclean[c(5:6, 10)]\nnames(beedata)<-collabs\nhead(beedata)\n\n```\n\n```{r}\n#remove duplicate observations\nduplicated(beedata)\nbeedata2<-beedata[!duplicated(beedata), ]\nduplicated(beedata2)\n```\n\n```{r}\n#plotdata\nlibrary(maptools)\ndata(\"wrld_simpl\")\nbeedata2$decimallat<-as.numeric(as.character(beedata2$decimallat))\nbeedata2$year<-as.numeric(as.character(beedata2$year))\nplot(wrld_simpl, xlim=c(-150, -50), ylim=c(30, 70), axes=T, col=\"lightgrey\")\npoints( x = beedata2$decimallong, y = beedata2$decimallat, col=\"red\", pch=16)\nstr (beedata2)\nsummary (beedata2)\noldbees<-filter(beedata2, year < 2000, year >= 1940, decimallat >= 45 | decimallong >= -100 )\nnewbees<-filter(beedata2, year > 2000)\n```\n\n\n```{r}\n#plotting old bees\nplot(wrld_simpl, xlim=c(-150, -50), ylim=c(30,70), axes=T, col=\"lightgrey\")\npoints( x = oldbees$decimallong, y = oldbees$decimallat, col=\"red\", pch=16)\n\n```\n\n```{r}\n#plotting new bees\nplot(wrld_simpl, xlim=c(-150, -50), ylim=c(30,70), axes=T, col=\"lightgrey\")\npoints(x = newbees$decimallong, y = newbees$decimallat, col=\"red\", pch=16)\n```\n\n```{r}\n#loading in rasters\ntemp<-raster (\"bio1.bil\")\nprecip<- raster (\"bio12.bil\")\nprecip_wq<- raster (\"bio13.bil\")\ntemp_wq<- raster(\"bio10.bil\")\n\npredictors<-stack ( temp, precip, precip_wq, temp_wq)\n\n#crop the stack \npredictors_crop<- crop (predictors,  extent(-150, -50, 30, 70))\nplot (predictors_crop)\n\n# we use the first file to create a RasterLayer\nplot(predictors_crop[[1]]) \nmask <- raster(predictors_crop[[1]])\nmask\n\n\n```\n```{r}\n# select 500 random points\n# set seed to assure that the examples will always have the same random sample.\nset.seed(2000)\nbg <- randomPoints(mask, 500 )\nhead (bg)\nstr (bg)\n\n```\n\n```{r}\n# set up the plotting area\nplot(!is.na(mask), legend=FALSE)\npoints(bg, cex=0.5)\n# now we repeat the sampling, but limit\n# the area of sampling using a spatial extent\ne <- extent(-150, -50, 30, 70)\nbg2 <- randomPoints(mask, 50, ext=e)\nplot(!is.na(mask), legend=FALSE)\nplot(e, add=TRUE, col=\"red\")\npoints(bg2, cex=0.5)\n\n\nplot (wrld_simpl, xlim=c(-180, -50), ylim=c(23,90), axes=T, col=\"lightgrey\")\npoints (data=xy, x=oldbees$decimallong, y=oldbees$decimallat, col=\"red\", pch=16, cex=.5)\npoints (bg, pch=16, col=\"blue\", cex=.25)\n```\n```{r}\n#We can now use the extract function as we did before to mine data from each of these geographic locations: \n#presences\nstr(predictors_crop)\n?extract\nhead(presvals)\npresvals <- extract(predictors_crop, oldbees[, c(2,1)])\npresvals <- na.omit (presvals) #gets rid of any observations with no data \n#psuedo-absences\nabsvals <- extract(predictors_crop, bg)\nabsvals <- na.omit (absvals) #gets rid of any observations with no data \nhead(absvals)\n#combine presences and absences into a single dataframe \npb <- c(rep(1, nrow(presvals)), rep(0, nrow(absvals)))\nsdmdata <- data.frame(cbind(pb, rbind(presvals, absvals)))\nhead(sdmdata)\n\n#investigate co-linearity: Are these predictors telling us the same thing? \npairs (sdmdata [,2:5], cex=.25, fig=TRUE)\n\n```\n\n```{r}\n#When two variables are strongly correlated it is best to run the model with only one of them, unless you have a strong biological reason to not do this \n\n#now our dataset is readly lets fit our first model (Chapter 5 in SDM)\n#lets start with a simple Generalized Linear Model (glm)\nm1 <- glm(pb ~ bio1 + bio13 + bio10, data=sdmdata)\nsummary (m1)\nresponse(m1)\n\n#with our model built we can now predict to the entire study extent: \nglm_pred<- predict (predictors_crop, m1)\nplot (glm_pred, col=rev(rainbow(50)), main=\"GLM\")# This now plots the habitat suitability for this species \n\n#evaluate the model \nmE1 <- evaluate(xy, bg, x= predictors_crop , m1)\nmE1\n\n#Apply a threshold to convert to a binary map:\n?threshold\ntr <- threshold(mE1,'spec_sens')\ntr\ncurrent_pa<- (glm_pred > tr)\nplot(glm_pred > tr, main='presence/absence')\n#how does this map change if we change the threshold type from spec_sens to the other thresholds? \n\n#lets now construct a generalized additive model (gam)\nlibrary (mgcv)\nm2<-gam(pb ~ bio1 * bio13 + bio10 , data=sdmdata)\nsummary (m2)\nresponse(m2)\ngam_pred<- predict (predictors_crop, m2)\nplot (gam_pred, col=rev(rainbow(50)), main=\"GAM\") \n```\n\n```{r}\n#Begin Lab 5 here: \n#project our models to a future climate \n#load in rasters and stack them: \n#Important to make sure the files in your future stack are the named the same as your predictor variables \nbio1f<-raster (\"bio1.tif\")\nbio12f<- raster(\"bio12.tif\")\nbio13f<- raster(\"bio13.tif\")\n#bio7f<- raster(\"bio7.tif\")\n\nfuture_stack<-stack (bio1f, bio12f, bio13f)\nplot (future_stack)\n\n#lets clip it to our study extent: \nfuture_crop<- crop (future_stack,  extent(-150, -50, 30, 70))\nplot (future_crop)\n\n#now all we do is project our models (m1 and m2) to the future stack! \nsummary (m1)\nsummary (m2)\n\nglm_future<- predict (future_crop, m1)\n\n#you can also apply teh threshold as you before to create a presence absence map \nglm_future_bi<-glm_future > tr\nplot (glm_future_bi)\n\n#now plot them\n\npar(mfrow=c(2,2)) \nplot (glm_pred, main=\"2017 Distribution\")\nplot (glm_future, main=\"2070 RCP 8.5\")\n\n#using raster math we can calculate the differences between the two maps \ndiff_map<- glm_future-glm_pred\nplot (diff_map, col=heat.colors(100), main=\"Difference Map\")\n\ndiff_pa_map<- glm_future_bi - current_pa\nplot (diff_pa_map, col=heat.colors(100), main=\"Difference Map P/A\")\n\n```\n\n\n",
    "created" : 1488302810172.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2524275529",
    "id" : "98B793F5",
    "lastKnownWriteTime" : 1488916595,
    "last_content_update" : 1488916595521,
    "path" : "~/Geography of Life/lab5/Bee Report.Rmd",
    "project_path" : "Bee Report.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}